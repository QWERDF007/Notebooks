# [SimpleNet: A Simple Network for Image Anomaly Detection and Localization](https://arxiv.org/abs/2303.15140)

<img src="./assets/SimpleNet_fig1.png">

**图 1**：MVTec AD 样本的可视化。生成的异常图叠加在图像上。高异常分数的异常区域用橙色表示。红色轮廓线表示异常的实际分割图边界。

## Abstract

我们提出了一个简单易用的网络 (称为SimpleNet)，用于检测和定位异常。SimpleNet 由四个组件组成：(1) 一个预训练的特征提取器，用于生成局部特征，(2) 一个浅层特征适配器，用于将局部特征转移到目标域，(3) 一个简单的异常特征生成器，通过向正常特征添加高斯噪声来伪造异常特征，以及 (4) 一个二进制异常鉴别器，用于区分异常特征和正常特征。在推理期间，异常特征生成器将弃用。我们的方法基于三个直觉。首先，将预训练的特征转换为面向目标的特征有助于避免域偏差。其次，在特征空间中生成合成异常更加有效，因为缺陷在图像空间中可能没有太多共性。第三，一个简单的鉴别器更加高效实用。尽管简单，但 SimpleNet 在定量和定性上均优于以前的方法。在 MVTec AD 基准测试中，SimpleNet 实现了99.6％ 的异常检测 AUROC，在减少错误 55.5％ 的同时比下一个最佳性能模型更好。此外，SimpleNet 比现有方法更快，在 3080ti GPU 上具有高帧率 77 FPS。此外，SimpleNet 在单类新颖性检测任务的性能方面也有显着改进。代码：https://github.com/DonaldRR/SimpleNet。

<img src="./assets/SimpleNet_fig2.png">

**图 2**：在 MVTec AD 基准测试上的推理速度 (FPS) 与 I-AUROC。SimpleNet 在准确率和效率方面都大幅超过了之前的所有方法。

## 1. Introduction

图像异常检测和定位任务旨在识别异常图像并定位异常子区域。检测各种感兴趣的异常的技术在工业检查中具有广泛的应用[3, 6]。在工业场景中，由于异常样本稀少且异常可能从细微的变化（如细小划痕）到大型结构缺陷（例如缺失部分）不等，因此异常检测和定位尤其困难。MVTec AD 基准测试中的一些示例以及我们提出的方法的结果如图 1 所示。这为基于有监督的方法带来了巨大困难。

目前的方法以无监督的方式解决这个问题，其中训练过程中仅使用正常样本。基于重建的方法[10, 21, 31]、基于合成的方法[17, 30]和基于嵌入的方法[6, 22, 24]是解决这个问题的三个主要趋势。基于重建的方法，如[21,31]，假设仅使用正常数据训练的深度网络无法准确重建异常区域。像素级重建误差被视为异常定位的异常分数。然而，这种假设并不总是成立，有时网络可以"泛化"得很好，以至于也可以很好地重建异常输入，导致误检[10, 19]。基于合成的方法[17, 30]通过在无异常图像上生成合成异常来估计正常和异常之间的决策边界。然而，合成图像不够逼真。来自合成数据的特征可能会偏离正常特征，使用这样的负样本进行训练可能会导致一个松散边界的正常特征空间，这意味着在分布特征空间中可能包含不明显的缺陷。

最近，基于嵌入的方法[6,7,22,24]取得了最先进的性能。这些方法利用在 ImageNet 上预训练的卷积神经网络 (CNN) 提取泛化的正常特征。然后采用多元高斯分布[6]、标准化流[24]和记忆库[22]等统计算法嵌入正常特征分布。通过将输入特征与学习到的分布或记忆的特征进行比较，实现异常检测。但是，工业图像通常与 ImageNet 具有不同的分布。直接使用这种有偏差的特征可能会导致不匹配的问题。此外，统计算法通常会受到高计算复杂度或高内存消耗的困扰。

为了缓解上述问题，我们提出了一种新颖的异常检测和定位网络，名为 SimpleNet。SimpleNet 利用了基于合成和基于嵌入的方式，并做出了几项改进。首先，我们没有直接使用预训练特征，而是提出使用特征适配器来产生面向目标的特征，以减少域偏差。其次，我们没有直接在图像上合成异常，而是通过在特征空间对正常特征加噪声来生成异常特征。我们认为，通过适当校准噪声范围，可以获得一个紧密边界的正常特征空间。第三，我们通过训练一个简单的判别器来简化异常检测过程，这比上述基于嵌入的方法采用的复杂统计算法计算效率更高。具体来说，SimpleNet 使用预训练的 backbone 提取正常特征，然后经特征适配器转移特征到目标域。然后，通过对适配后的正常特征添加高斯噪声来简单地生成异常特征。在这些特征上训练了一个由几层 MLP 层组成的简单判别器来判别异常。

SimpleNet 易于训练和应用，性能和推理速度出色。基于广泛使用的 WideResnet50 骨干网络，我们提出的 SimpleNet 在 MVTec AD 数据集上取得了 99.6% 的 AUROC，同时以 77 fps 的速度运行，在准确性和效率方面都超过了之前发表的最佳异常检测方法，见图 2。我们进一步将 SimpleNet 引入到 OneClass Novelty Detection 任务中，以展示其泛化性。这些优势使 SimpleNet 架起了学术研究和工业应用之间的桥梁。代码将公开可用。

## 2. Related Work

异常检测和定位方法可以主要分为三类，即基于重建的方法、基于合成的方法和基于嵌入的方法。

**基于重建的方法**认为异常图像区域由于在训练样本中不存在，因此不应该能够被正确重建。一些方法[10]利用生成模型，例如自动编码器和生成对抗网络对正常数据进行编码和重建。其他方法[13,21,31]将异常检测框架视为图像修复问题，其中图像块被随机遮蔽。然后，利用神经网络预测被擦除的信息。在训练中广泛使用结构相似性指数 (SSIM) 损失函数。异常图通过输入图像与其重建图像之间的逐像素差异生成的。然而，如果异常与正常训练数据共享组成模式 (例如局部边缘) 或或者解码器"过于强大"，可以很好地解码某些异常编码，则图像中的异常很可能会被很好地重建[31]。

## 3. Method

<img src="./assets/SimpleNet_fig3.png">

**图 3**：提出的 SimpleNet 的概览。在训练阶段，将正常样本馈送到预训练的特征提取器中以获取局部特征。然后，使用特征适配器将预训练的特征适应到目标域。通过向适应特征添加高斯噪声来合成异常特征。适应后的特征和异常特征分别用作正样本和负样本，以训练最终的鉴别器。在推理期间，将删除异常特征生成器。



## 5. Conclusion

在本文中，我们提出了一种名为 SimpleNet 的简单而高效的方法，用于无监督的异常检测和定位。SimpleNet 由几个简单的神经网络模块组成，易于在工业场景中进行训练和应用。尽管简单，但SimpleNet 在 MVTec AD 基准测试中相对于以前的最先进方法实现了最高的性能和最快的推理速度。SimpleNet 为异常检测和定位领域中学术研究和工业应用之间的差距提供了新的视角。