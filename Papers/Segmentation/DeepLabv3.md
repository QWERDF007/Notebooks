# [Rethinking Atrous Convolution for Semantic Image Segmentation](https://arxiv.org/pdf/1706.05587.pdf)

## Abstract

在这项工作中，我们重新审视了在语义分割中应用中的空洞卷积，它一种强大的工具，可以显式地调整滤波器的感受野和控制由深度卷积神经网络计算的特征表示的分辨率。为了解决多尺度的分割对象的问题 (同一张图上有多种尺度的分割对象)，我们设计了一种以串行或并行方式采用空洞卷积的模块，通过使用多种空洞率来捕获多尺度的上下文。此外，我们提出用编码全局上下文的图像级的特征来增强我们之前提出的空洞金字塔汇聚模块，它在多个尺度上探测卷积特征，并进一步提升性能。我们还详细阐述了实现细节，并分享了训练我们系统的经验。所提出的 "DeepLabv3" 系统在没有 DenseCRF 后处理的情况下，明显地超过了我们之前的 DeepLab 版本，并在 PASCAL VOC 2012 语义图像分割基准上取得了与其他最先进水平的模型可比较的性能。

## 1. Introduction

对于语义分割任务，我们考虑在应用深度卷积神经网络 (DCNNs) 中的两个挑战。第一个是由连续的汇聚操作或卷积 striding 所导致的特征分辨率降低，汇聚和==卷积 striding (步长大于 1 的卷积)== 使得 DCNNs 能够学习越来越抽象的特征表示。然而，这种对于局部图像变换的不变性可能会阻碍密集预测任务，其需要详细的空间信息。为了解决这个问题，我们提倡使用空洞卷积，它已经被证明对语义图像分割是有效的。空洞卷积，也被称为扩张卷积，允许我们重新利用在 ImageNet 上预训练的网络提取更密集的特征映射，通过从最后几层中移除下采样操作，并上采样相应的滤波器核，相当于在滤波器权重直接插入孔 (法语：'trous')。通过空洞卷积，可以控制在 DCNNs 中计算的特征响应的分辨率，而不需要学习额外的参数。

另外一个困难来自于多尺度物体的存在。一些方法已经被提出来处理这个问题，在本文中我们主要考虑四类，如图 2 所示。首先，将 DCNN 应用于一个图像金字塔来提取每个尺度的输入的特征，不同尺度的物体在不同尺度的特征映射上变得明显。第二，编码器—解码器结构利用编码器部分的多尺度特征，并从解码器部分恢复空间分辨率。第三，额外的模块级联在原始网络上，用于捕获长距离的信息。特别地，使用 DenseCRF 对图像级两两相似性进行编码，同时级联地 develop 一些额外的卷积层以逐渐捕获远距离的上下文。第四，用带多种 rates 和多种感受野的滤波器或汇聚操作的空间金字塔汇聚探测到来的特征映射，从而捕获多个尺度的物体。

在本项工作中，我们重新审视了在级联模块和空间金字塔汇聚框架中应用空洞卷积，它允许我们有效地扩大滤波器的感受野，以合并多尺度的上下文。特别地，我们提出的模块由具有不同空洞率的空洞卷积和批量规范化层组成，我们发现 BN 对于训练也重要。我们尝试以级联或并行 (特别是空洞空间金字塔汇聚 (ASPP) 方法) 的方式布置模块 。我们讨论了在应用 $3 \times 3$ 空洞卷积时遇到的一个重要的实际问题，该卷积由于图像边界效应而不能捕获远距离信息，实际上简单地退化成 $1 \times 1$ 的卷积，并提出将图像级特征纳入到 ASPP 模块中。此外，我们详细阐述了实现细节，并分享了训练所提出模型的经验，包括一个简单但有效的 bootstrapping 方法，用于处理罕见的、精细标注的物体。最后，我们提出的模型 "DeepLabv3" 超过了我们之前的工作，在没有 DenseCRF 后处理的情况下，在 PASCAL VOC 2012 测试集上获得了 85.7% 的性能。

## 2. Related Work

已有研究表明全局特征或者上下文的交互对于语义分割正确地分类像素是有益的。在本工作中，我们讨论四类全卷积网络 (FCNs) (见图 2 以说明)，它们利用上下文信息进行语义分割。

**图像金字塔：** 同样的模型，通常具有共享的权重，被应用于多尺度的输入。来自小尺度的输入的特征响应编码远距离的上下文，而大尺度的输入保留了小物体的细节。典型的例子包括 Farabet 等人的 [22]，它们通过一个拉普拉斯金字塔对图像进行变换，将每个尺度的输入喂给 DCNN，并合并来自所有尺度的特征映射。[19, 69] 从粗到细依次应用多尺度的输入，而 [55, 12, 11] 直接将输入 resize 到多个尺度并融合来自所有尺度的特征。这种类型的模型的主要缺点是，由于 GPU 内存有限，它不能很好地扩展到更大/更深的 DCNNs (例如像 [32, 91, 86] 这些模型)，因此它通常被应用在推理阶段。

**编码器—解码器：** 这种模型由两部分组成：(a) 编码器，特征映射的空间维度在逐渐减小，因此更远距离的信息在更深的编码器输出中更容易被捕获，(b) 解码器，物体的细节和空间维度在逐渐恢复。例如，[60, 64] 使用转置卷积学习低分辨率特征的上采样。SegNet 重用来自编码器的汇聚索引，并学习额外的卷积层来使特征响应变密集，而 U-Net 从编码器特征添加跳跃连接到相应的解码器激活，[25] 使用一个拉普拉斯金字塔来重建网络。最近，RefineNet 和 [70, 68, 39] 已经在一些语义分割基准上证明了基于编码器—解码器结构的模型的有效性。这种类型的模型也被用于目标检测。

**上下文模块：** 这种模型包含额外的以级联方式布置的模块来编码长距离的上下文。一种有效的方法是将 DenseCRF (带有高效的高维滤波算法) 与 DCNNs 结合。此外，[96, 55, 73] 提出联合地训练 CRF 和 DCNN 组件，而 [59, 90] 在 DCNNs 的 ==belief maps (即 DCNN 最后的特征映射，包含与预测类别数量相等的通道数)== 上使用一些额外的卷积层来捕获上下文信息。最近 [41] 提出学习一种通用的和稀疏的高维的卷积 (bilateral convolution)，[82, 8] 结合高斯条件随机场和 DCNNs 进行语义分割。

**空间金字塔汇聚：** 这种模型使用空间金字塔汇聚来捕获多个距离的上下文。ParseNet 利用图像级特征来获取全局上下文信息。DeepLabv2 [11] 提出空洞空间金字塔汇聚 (ASPP)，采用不同空洞率的、并行的空洞卷积来捕获多尺度的上下文。最近，金字塔场景解析网络 (PSP) 在多个网格尺度上执行空间汇聚，并在多个语义分割基准上展现出优秀的性能。还有其他基于 LSTM 聚合全局上下文的方法 [53, 6, 88]。空间金字塔汇聚也被用于目标检测。

在本工作中，我们主要探索将空洞卷积作为空间金字塔汇聚的一个上下文模块和工具。我们提出的框架在意义上来说是通用，它可以应用于任何网络。具体而言，我们复制了原始 ResNet 的最后一个块的几个副本，并以级联的方式排列它们，并重新审视了包含几个并行的空洞卷积的 ASPP 模块。请注意我们的级联模块直接应用于特征映射上，而不是 belief maps。对于提出的模块，我们在实验中发现使用批量规范化一起训练是重要的。为了进一步捕获全局特征，我们提出使用图像级特征来增强 ASPP，类似于 [58, 95]。

**空洞卷积：** 基于空洞卷积的模型已经在语义分割上得到积极地探索。例如，[85] 通过实验修改空洞率来捕获长距离信息，[84] 在 ResNet 的最后两个块中使用混合的空洞率，而 [18] 进一步提出学习变形卷积，用学习到的偏移量采样输入特征，推广了空洞卷积。为了进一步提升分割模型的准确性，[83] 利用了图像描述，[40] 利用了视频运动，[44] 加入了深度信息。此外，空洞卷积被 [66, 17, 37] 应用于目标检测。

## 3. Methods

在本节中，我们回顾如何应用空洞卷积来为语义分割提取密集的特征。然后我们讨论所提出的模块，它以级联或并行方式使用空洞卷积。

### 3.1. Atrous Convolution for Dense Feature Extraction

以全卷积 (即整个网络都是卷积、汇聚等) 的方式部署的深度卷积神经网络 (DCNNs) 已经被证明对语义分割任务是有效的。然而，在这些网络的连续层中重复组合最大汇聚和 striding，会严重地降低所得到特征映射的空间分辨率，在最近的 DCNNs [47, 78,32] 中，每个方向的分辨率通常为 32 倍。去卷积层 (或转置卷积) 已经被用于恢复空间分辨率。相反，我们主张使用空洞卷积，最初是为了在 [36] "算法 a trous" 方案中高效计算无抽样小波变换而开发的，且之前被 [26, 74, 66] 在 DCNN 的上下文中用过。

考虑二维信号，对于输出 $\boldsymbol{y}$ 每个位置 $i$ 和一个滤波器 $\boldsymbol{w}$，对输入特征映射 $\boldsymbol{x}$ 应用空洞卷积：
$$
\large \boldsymbol{y}[i] = \sum_k \boldsymbol{x}[i + r \cdot k] \boldsymbol{w}[k] \tag{1}
$$
其中空洞率 $r$ 对应于我们对输入信息进行采样的步长，这相当于将输入 $x$ 与上采样滤波器进行卷积，该滤波器通过在每个空间维度上两个连续的滤波器值之间插入 $r - 1$ 个 0 而产生 (因此得名空洞卷积，在法语中 trous 等同于英语中的 holes)。标准卷积是 $r = 1$ 时的一个特例，空洞卷积允许我们通过改变空洞率的值来自适应地修改感受野。如图 1 所示。

空洞卷积还允许我们显式地控制在全卷积网络中计算的特征响应的密集程度。















## 5. Conclusion

我们所提出的模型 "DeepLabv3" 使用有上采样滤波器的空洞卷积来提取密集的特征映射和捕获远距离上下文。具体而言，为了编码多尺度的信息，我们提出的级联模块逐渐地将空洞率翻倍，而我们提出的用图像级特征增强的空洞空间金字塔汇聚模块用多个采样率和有效感受野的滤波器探测特征。我们的实验结果表明所提出的模型显著地超过了之前的 DeepLab 版本，并在 PASCAL VOC 2012 语义图像分割基准上取得了与其他最先进的模型可比较的性能。
